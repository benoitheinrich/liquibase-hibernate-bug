# Description

Reproduces a problem with [liquibase-maven-plugin](https://github.com/liquibase/liquibase/tree/master/liquibase-maven-plugin) using the [liquibase-hibernate5](https://github.com/liquibase/liquibase-hibernate) extension.

The issue reported is about using the `liquibase:diff` goal which always drop and recreate indexes when there is no changes to the schema.

# Setting up your DB connection

Checkout this repository and open the `pom.xml` file.

In order to run this you'll need to make sure that you setup the properties in the `pom.xml` correctly.

    <db.driver>org.mariadb.jdbc.Driver</db.driver>
    <db.url>jdbc:mysql://localhost:3306/someTest?createDatabaseIfNotExist=true</db.url>
    <db.username>root</db.username>
    <db.password/>
    <db.dialect>org.hibernate.dialect.MySQL5Dialect</db.dialect>

Be aware that to reproduce this issue you'll need to run the `liquibase:dropAll` command that will drop all tables in your DB.

Make sure you run that into a test DB, or that you have a backup first.

The default configuration uses MySQL but this doesn't only affect MySQL but also affects Oracle DB.
I suspect this might actually affect all DBMS.

# How to reproduce

Once you've setup your DB connection you can run the following commands:

    mvn clean install
    mvn liquibase:dropAll
    mvn liquibase:update
    mvn liquibase:diff

Be aware that the `liquibase:dropAll` command will drop all tables in your DB, so make sure you run that into a test DB, or that you have a backup first.

Once you've ran the `liquibase:diff` command it'll generate the `liquibase-diff-changeLog.xml` file into the root of the project.
This file will contain the following content:

```$xml
<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.6.xsd">
    <changeSet author="benoit (generated)" id="1542806934981-1">
        <dropIndex indexName="AN_ENTITY_DATETIME" tableName="AN_ENTITY"/>
        <createIndex indexName="AN_ENTITY_DATETIME" tableName="AN_ENTITY">
            <column name="DATE_TIME"/>
        </createIndex>
    </changeSet>
</databaseChangeLog>
```

As no changes were made to the entity no changes should have been detected and generated by the `liquibase:diff` command.

That's the bug !!
